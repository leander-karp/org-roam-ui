"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[475],{1475:function(e,r,l){l.r(r),l.d(r,{default:function(){return A}});var t=l(5893),n=l(6353),i=l(5424),o=l(8940),d=l(7747),u=l(7294),c=l(4087),a=l.n(c);function s(e){let r=(0,u.useRef)(e);return r.current=e,r}function h(e){let r=(0,u.useRef)(),l=s(e);return r.current||(r.current=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return l.current.apply(this,r)}),r.current}function g(e,r,l){let t=(0,u.useRef)(0),n=(0,u.useRef)(0),i=s(e),o=h(e=>{n.current||(n.current=e);let d=e-n.current,u=r>0?d/r:1;u<0&&(u=0),u>1&&(u=1),u<1&&(t.current=a()(o)),l?i.current(l(u)):i.current(u)}),d=(0,u.useCallback)(()=>{t.current&&(a().cancel(t.current),t.current=0),n.current=0},[]),c=h(()=>{d(),t.current=a()(o)});return!function(e){let r=(0,u.useRef)(e);r.current=e,(0,u.useEffect)(()=>()=>{r.current()},[])}(d),[c,d]}var f=l(6765),v=l(2802),p=l.n(v),k=l(5871),m=l(2280),C=l(2591),b=l(2663),y=l.n(b),S=l(3179);let N=e=>{var r;let{linksByNodeId:l,visuals:t,highlightedNodes:n,previouslyHighlightedNodes:i,opacity:o,node:d}=e,u=null!==(r=l[d.id])&&void 0!==r?r:[],c=u.length?u.filter(e=>"parent"===e.type).length:0,a=3+u.length*t.nodeSizeLinks-(S.hX.parent?0:c);return 1===t.highlightNodeSize?a:a*(n[d.id]||i[d.id]?1+o*(t.highlightNodeSize-1):1)};function x(e,r){return"rgba("+(e=e.replace("#","")).match(RegExp("(.{"+e.length/3+"})","g")).map(r=>parseInt(e.length%2?r+r:r,16)).concat(isFinite(r)?r:1).join(",")+")"}let I=(e,r,l,t,n)=>n?Math.max(e,t):1*e*(-1*(r.highlightFade*t-1));var F=l(5315);let L=e=>{let{ids:r,excludedIds:l,n:t,linksByNodeId:n}=e,i=[r[0]],o=[],d=[r[0]];return Array.from({length:t},()=>{i.forEach(e=>{var r;(null!==(r=n[e])&&void 0!==r?r:[]).forEach(e=>{let[r,t]=(0,F.J)(e);if(!l.some(e=>[r,t].includes(e))){if(!d.includes(r)){o.push(r);return}d.includes(t)||o.push(t)}})}),i=o,o.forEach(e=>e&&d.push(e)),o=[]}),d};var E=l(9055);let R=(e,r,l)=>Math.min(Math.max(e,r),l),w=e=>{var r,l;let{id:t,linksByNodeId:n,visuals:i,coloring:o,cluster:d}=e,u=null!==(l=null===(r=n[t])||void 0===r?void 0:r.length)&&void 0!==l?l:0;return"degree"===o.method?i.nodeColorScheme[R(u,0,i.nodeColorScheme.length-1)]:i.nodeColorScheme[u&&d[t]%i.nodeColorScheme.length]},M=e=>{var r,l;let{node:t,theme:n,highlightedNodes:i,previouslyHighlightedNodes:o,visuals:d,tagColors:u,highlightColors:c,opacity:a,emacsNodeId:s,linksByNodeId:h,cluster:g,coloring:f}=e,v=i[t.id]||o[t.id];if(d.emacsNodeColor&&t.id===s)return(0,E.p)(d.emacsNodeColor,n);if(u&&(null==t?void 0:t.tags.some(e=>u[e]))){let e=u[null==t?void 0:t.tags.filter(e=>u[e])[0]];return v?c[e][e](d.highlightFade*a):c[e][d.backgroundColor](d.highlightFade*a)}return d.citeNodeColor&&(null==t?void 0:null===(r=t.properties)||void 0===r?void 0:r.ROAM_REFS)&&(null==t?void 0:null===(l=t.properties)||void 0===l?void 0:l.FILELESS)?v?(0,E.p)(d.citeNodeColor,n):c[d.citeNodeColor][d.backgroundColor](d.highlightFade*a):d.refNodeColor&&t.properties.ROAM_REFS?v?(0,E.p)(d.refNodeColor,n):c[d.refNodeColor][d.backgroundColor](d.highlightFade*a):v?d.nodeHighlight?c[w({id:t.id,cluster:g,coloring:f,linksByNodeId:h,visuals:d})][d.nodeHighlight](a):(0,E.p)(w({id:t.id,cluster:g,coloring:f,linksByNodeId:h,visuals:d}),n):c[w({id:t.id,cluster:g,coloring:f,linksByNodeId:h,visuals:d})][d.backgroundColor](d.highlightFade*a)},O=(e,r)=>{var l,t;return(null===(l=e.source)||void 0===l?void 0:l.id)===(null==r?void 0:r.id)||(null===(t=e.target)||void 0===t?void 0:t.id)===(null==r?void 0:r.id)},D=e=>{let{sourceId:r,targetId:l,linksByNodeId:t,visuals:n,coloring:i,cluster:o}=e;return t[r].length>t[l].length?w({id:r,linksByNodeId:t,visuals:n,cluster:o,coloring:i}):w({id:l,visuals:n,linksByNodeId:t,cluster:o,coloring:i})},H=e=>{let{sourceId:r,targetId:l,needsHighlighting:t,theme:n,visuals:i,highlightColors:o,opacity:d,linksByNodeId:u,coloring:c,cluster:a}=e;if(!i.linkHighlight&&!i.linkColorScheme&&!t){let e=D({sourceId:r,targetId:l,linksByNodeId:u,visuals:i,coloring:c,cluster:a});return(0,E.p)(e,n)}if(!t&&!i.linkColorScheme)return o[D({sourceId:r,targetId:l,linksByNodeId:u,visuals:i,coloring:c,cluster:a})][i.backgroundColor](i.highlightFade*d);if(!t)return o[i.linkColorScheme][i.backgroundColor](i.highlightFade*d);if(!i.linkHighlight&&!i.linkColorScheme){let e=D({sourceId:r,targetId:l,linksByNodeId:u,visuals:i,coloring:c,cluster:a});return(0,E.p)(e,n)}return i.linkHighlight?i.linkColorScheme?o[i.linkColorScheme][i.linkHighlight](d):o[D({sourceId:r,targetId:l,linksByNodeId:u,visuals:i,coloring:c,cluster:a})][i.linkHighlight](d):(0,E.p)(i.linkColorScheme,n)},B=l.e(674).then(l.bind(l,898));function A(e){let{graphRef:r,physics:l,graphData:c,threeDim:a,linksByNodeId:s,filter:h,emacsNodeId:v,nodeById:b,visuals:S,behavior:R,mouse:w,scope:D,local:A,webSocket:j,tagColors:z,setPreviewNode:T,sidebarHighlightedNode:W,windowWidth:J,windowHeight:Z,openContextMenu:_,contextMenu:G,handleLocal:P,variables:V,clusterRef:X,coloring:Y}=e,{dailyDir:$}=V,[q,K]=(0,u.useState)(null),Q=(0,o.F)(),{emacsTheme:U}=(0,u.useContext)(n.N),ee=(e,r,l)=>{switch(e){case w.preview:T(r);break;case w.local:P(r,R.localSame);break;case w.follow:(0,C.y2)(r,j);break;case w.context:_(r,l)}},er=(0,u.useRef)(null);(0,u.useEffect)(()=>{v&&K(b[v])},[v]);let el=(0,u.useRef)({}),et=(0,u.useRef)({}),en=(0,u.useMemo)(()=>{var e;et.current={};let r=null==c?void 0:null===(e=c.nodes)||void 0===e?void 0:e.filter(e=>{var r,l,t,n;return!(h.dirsBlocklist.length&&h.dirsBlocklist.some(r=>{var l;return null==e?void 0:null===(l=e.file)||void 0===l?void 0:l.includes(r)})||h.dirsAllowlist.length>0&&!h.dirsAllowlist.some(r=>{var l;return null==e?void 0:null===(l=e.file)||void 0===l?void 0:l.includes(r)})||h.tagsBlacklist.length&&h.tagsBlacklist.some(r=>{var l;return(null==e?void 0:null===(l=e.tags)||void 0===l?void 0:l.indexOf(r))>-1})||h.tagsWhitelist.length>0&&!h.tagsWhitelist.some(r=>{var l;return(null==e?void 0:null===(l=e.tags)||void 0===l?void 0:l.indexOf(r))>-1})||h.filelessCites&&(null==e?void 0:null===(r=e.properties)||void 0===r?void 0:r.FILELESS)||(null==h?void 0:h.bad)&&(null==e?void 0:null===(l=e.properties)||void 0===l?void 0:l.bad)||h.dailies&&$&&(null===(t=e.file)||void 0===t?void 0:t.includes($)))&&(!h.noter||null===(n=e.properties)||void 0===n||!n.NOTER_PAGE)||(et.current={...et.current,[e.id]:e},!1)}).filter(e=>{var r;let l=(null!==(r=s[null==e?void 0:e.id])&&void 0!==r?r:[]).filter(e=>!et.current[e.source]&&!et.current[e.target]);return!h.orphans||(h.parent?0!==l.length:0!==l.length&&l.some(e=>!["parent","heading"].includes(e.type)))}),l=r.map(e=>e.id),t=c.links.filter(e=>{let[r,t]=(0,F.J)(e);return!!(l.includes(r)&&l.includes(t))&&(h.parent?"heading"===h.parent?"parent"!==e.type:"heading"!==e.type:!["parent","heading"].includes(e.type))});el.current=t.reduce((e,r)=>{var l,t;let[n,i]=(0,F.J)(r);return{...e,[n]:[...null!==(l=e[n])&&void 0!==l?l:[],r],[i]:[...null!==(t=e[i])&&void 0!==t?t:[],r]}},{});let n=t.map(e=>{let[r,l]=(0,F.J)(e);return{target:r,source:l,weight:"cite"===e.type?1:2}});if("community"===Y.method){let e=p()().nodes(l).edges(n);X.current=e()}return{nodes:r,links:t}},[h,c,Y.method]),[ei,eo]=(0,u.useState)({nodes:[],links:[]});(0,u.useEffect)(()=>{if(!D.nodeIds.length)return;let e=D.nodeIds.length>1?ei.nodes.filter(e=>!D.excludedNodeIds.includes(e.id)):[],r=e.map(e=>e.id),l=L({ids:D.nodeIds,excludedIds:D.excludedNodeIds,n:A.neighbors,linksByNodeId:el.current}),t=en.nodes.filter(t=>{if(e.length){var n;return!r.includes(t.id)&&(null!==(n=el.current[t.id])&&void 0!==n?n:[]).some(e=>{let[r,l]=(0,F.J)(e);return!D.excludedNodeIds.includes(r)&&!D.excludedNodeIds.includes(l)&&(D.nodeIds.includes(r)||D.nodeIds.includes(l))})}return l.includes(t.id)}).map(e=>({...e,x:0,y:0,vy:0,vx:0})),n=[...e,...t],i=n.map(e=>e.id),o=[],d=en.links.filter(e=>{let[l,t]=(0,F.J)(e);return!(o.length&&r.includes(t)&&r.includes(l))&&i.includes(l)&&i.includes(t)}).map(e=>{let[r,l]=(0,F.J)(e);return{source:r,target:l}});eo({nodes:n,links:[...o,...d]})},[A.neighbors,h,D,D.excludedNodeIds,D.nodeIds,c,en.links,en.nodes]),(0,u.useEffect)(()=>{(async()=>{let e=r.current,t=await B;l.gravityOn&&!(D.nodeIds.length&&!l.gravityLocal)?(e.d3Force("x",t.forceX().strength(l.gravity)),e.d3Force("y",t.forceY().strength(l.gravity)),a&&e.d3Force("z",t.forceZ().strength(l.gravity))):(e.d3Force("x",null),e.d3Force("y",null),a&&e.d3Force("z",null)),l.centering?e.d3Force("center",t.forceCenter().strength(l.centeringStrength)):e.d3Force("center",null),l.linkStrength&&e.d3Force("link").strength(l.linkStrength),l.linkIts&&e.d3Force("link").iterations(l.linkIts),l.charge&&e.d3Force("charge").strength(l.charge),e.d3Force("collide",l.collision?t.forceCollide().radius(l.collisionStrength):null)})()},[l,a,D]),(0,u.useEffect)(()=>{var e;null===(e=r.current)||void 0===e||e.d3ReheatSimulation()},[l,D.nodeIds.length]);let ed=(0,u.useRef)(0),[eu,ec]=(0,u.useState)(1),[ea,es]=g(e=>ec(e),S.animationSpeed,m.Al[S.algorithmName]),[eh,eg]=g(e=>ec(Math.min(eu,-1*(e-1))),S.animationSpeed,m.Al[S.algorithmName]),ef=(0,u.useMemo)(()=>{var e;if(!er.current)return{};let r=el.current[er.current.id];return r?Object.fromEntries([null===(e=er.current)||void 0===e?void 0:e.id,...r.flatMap(e=>[e.source,e.target])].map(e=>[e,{}])):{}},[er.current,el.current]);(0,u.useEffect)(()=>{(null==W?void 0:W.id)?K(W):K(null)},[W]);let ev=(0,u.useRef)(null);(0,u.useEffect)(()=>{if(er.current=q,q&&(ev.current=q),!S.highlightAnim)return q?ec(1):ec(0);q?ea():(es(),eu>.5?eh():ec(0))},[q]);let ep=(0,u.useMemo)(()=>Object.fromEntries(m.bG.map(e=>{let r=(0,E.p)(e,Q);return[e,Object.fromEntries(m.bG.map(e=>[e,f.Z(r,(0,E.p)(e,Q))]))]})),[U]),ek=(0,u.useMemo)(()=>{var e,r;let l=null===ev.current||void 0===ev.current?[]:null!==(r=el.current[ev.current.id])&&void 0!==r?r:[];return Object.fromEntries([null===(e=ev.current)||void 0===e?void 0:e.id,...l.flatMap(e=>(0,F.J)(e))].map(e=>[e,{}]))},[JSON.stringify(q),ev.current,el.current]),em=(0,u.useMemo)(()=>(0,E.p)(S.labelTextColor,Q),[S.labelTextColor,U]),eC=(0,u.useMemo)(()=>(0,E.p)(S.labelBackgroundColor,Q),[S.labelBackgroundColor,U]),[eb,ey]=(0,u.useState)(!1),eS=(0,u.useRef)(1),eN={graphData:D.nodeIds.length?ei:en,width:J,height:Z,backgroundColor:(0,E.p)(S.backgroundColor,Q),warmupTicks:1===D.nodeIds.length?100:D.nodeIds.length>1?20:0,onZoom:e=>{let{k:r}=e;return eS.current=r},nodeColor:e=>M({node:e,theme:Q,visuals:S,cluster:X.current,coloring:Y,emacsNodeId:v,highlightColors:ep,highlightedNodes:ef,previouslyHighlightedNodes:ek,linksByNodeId:el.current,opacity:eu,tagColors:z}),nodeRelSize:S.nodeRel,nodeVal:e=>N({node:e,highlightedNodes:ef,linksByNodeId:el.current,opacity:eu,previouslyHighlightedNodes:ek,visuals:S})/Math.pow(eS.current,S.nodeZoomSize),nodeCanvasObject:(e,r,l)=>{!function(e){var r,l,t,n;let{labelBackgroundColor:i,labelTextColor:o,node:d,ctx:u,globalScale:c,highlightedNodes:a,previouslyHighlightedNodes:s,visuals:h,opacity:g,filteredLinksByNodeId:f,hoverNode:v,lastHoverNode:p}=e;if(!d||!h.labels)return;let k=null!==(r=null==v?void 0:v.id)&&void 0!==r?r:"",m=null!==(l=null==p?void 0:p.id)&&void 0!==l?l:"",C=null!==(t=f[d.id])&&void 0!==t?t:[],b=!!(a[d.id]||s[d.id]),S=Math.min(5*(c-h.labelScale)+2*Math.pow(Math.min(C.length,h.labelDynamicDegree),h.labelDynamicStrength),1);if(S<.01&&!b)return;let F=null!==(n=d.title)&&void 0!==n?n:"",L=F.substring(0,h.labelLength),E=Math.cbrt(h.nodeRel*N({node:d,highlightedNodes:a,linksByNodeId:f,opacity:g,previouslyHighlightedNodes:s,visuals:h})/Math.pow(c,h.nodeZoomSize)),R=h.labelFontSize/Math.cbrt(Math.pow(c,h.nodeZoomSize)),w=[1.1*u.measureText(L).width,R].map(e=>e+.5*R),M=I(S,h,c,g,b);if(h.labelBackgroundColor&&h.labelBackgroundOpacity){let e=x(i,M*h.labelBackgroundOpacity);u.fillStyle=e,u.fillRect(d.x-w[0]/2,d.y-w[1]/2+E,...w)}u.textAlign="center",u.textBaseline="middle";let O=x(o,M);u.fillStyle=O,u.font="".concat(R,"px Sans-Serif");let D=y()(L,{width:h.labelWordWrap}).split("\n"),H=F.length>h.labelLength?[...D.slice(0,-1),"".concat(D.slice(-1),"...")]:D,B=[k,m].includes(d.id)?1+.3*g:1;H.forEach((e,r)=>{u.fillText(e,d.x,d.y+B*E*8+h.labelLineSpace*R*r)})}({nodeRel:S.nodeRel,filteredLinksByNodeId:el.current,lastHoverNode:ev.current,node:e,ctx:r,globalScale:l,highlightedNodes:ef,previouslyHighlightedNodes:ek,visuals:S,opacity:eu,labelTextColor:em,labelBackgroundColor:eC,hoverNode:q})},nodeCanvasObjectMode:()=>"after",linkDirectionalParticles:S.particles?S.particlesNumber:void 0,linkDirectionalArrowLength:S.arrows?S.arrowsLength:void 0,linkDirectionalArrowRelPos:S.arrowsPos,linkDirectionalArrowColor:S.arrowsColor?()=>(0,E.p)(S.arrowsColor,Q):void 0,linkColor:e=>{var r;let l="object"==typeof e.source?e.source.id:e.source,t="object"==typeof e.target?e.target.id:e.target,n=O(e,er.current),i=O(e,ev.current),o=n||i;return S.refLinkColor&&"ref"===e.type?o&&(S.refLinkHighlightColor||S.linkHighlight)?ep[S.refLinkColor][S.refLinkHighlightColor||S.linkHighlight](eu):ep[S.refLinkColor][S.backgroundColor](S.highlightFade*eu):S.citeLinkColor&&(null===(r=e.type)||void 0===r?void 0:r.includes("cite"))?o&&(S.citeLinkHighlightColor||S.linkHighlight)?ep[S.citeLinkColor][S.citeLinkHighlightColor||S.linkHighlight](eu):ep[S.citeLinkColor][S.backgroundColor](S.highlightFade*eu):H({sourceId:l,targetId:t,needsHighlighting:o,theme:Q,cluster:X.current,coloring:Y,highlightColors:ep,linksByNodeId:el.current,opacity:eu,visuals:S})},linkWidth:e=>{if(1===S.highlightLinkSize)return S.linkWidth;let r=O(e,er.current),l=O(e,ev.current);return r||l?S.linkWidth*(1+eu*(S.highlightLinkSize-1)):S.linkWidth},linkDirectionalParticleWidth:S.particlesWidth,d3AlphaDecay:l.alphaDecay,d3AlphaMin:l.alphaMin,d3VelocityDecay:l.velocityDecay,onNodeClick:(e,r)=>{let l=r.timeStamp-ed.current<200;if(ed.current=r.timeStamp,l)return ee("double",e,r);let t=ed.current;return setTimeout(()=>{if(ed.current===t)return ee("click",e,r)},200)},onNodeHover:e=>{S.highlight&&!eb&&(q||(eg(),ec(0)),K(e))},onNodeRightClick:(e,r)=>{ee("right",e,r)},onNodeDrag:e=>{K(e),ey(!0)},onNodeDragEnd:()=>{K(null),ey(!1)}};return(0,t.jsx)(d.xu,{overflow:"hidden",onClick:G.onClose,children:a?(0,t.jsx)(i.s6,{ref:r,...eN,nodeThreeObjectExtend:!0,nodeOpacity:S.nodeOpacity,nodeResolution:S.nodeResolution,linkOpacity:S.linkOpacity,nodeThreeObject:e=>{if(!S.labels||S.labels<3&&!ef[e.id])return;let r=new k.Z(e.title.substring(0,40));return r.color=(0,E.p)(S.labelTextColor,Q),r.backgroundColor=(0,E.p)(S.labelBackgroundColor,Q),r.padding=2,r.textHeight=8,r}}):(0,t.jsx)(i.f$,{ref:r,...eN,linkLineDash:e=>{var r;return S.citeDashes&&(null===(r=e.type)||void 0===r?void 0:r.includes("cite"))?[S.citeDashLength,S.citeGapLength]:S.refDashes&&"ref"==e.type?[S.refDashLength,S.refGapLength]:null}})})}}}]);